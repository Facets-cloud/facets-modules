intent: service
flavor: statefulset
version: "0.1"
description: Adds service module
clouds:
  - aws
  - azure
  - gcp
  - kubernetes
artifact_inputs:
  primary:
    attribute_path: "spec.release.image"
    artifact_type: "docker_image"
metadata:
  title: Metadata of service
  type: object
  properties:
    namespace:
      type: string
      title: Namespace
      description: Namespace in which statefulset should be deployed
      default: default
spec:
  title: K8s flavor of service
  type: object
  properties:
    type:
      type: string
      title: Service Type
      description: Type - Statefulset
      x-ui-override-disable: true
      default: statefulset
    persistent_volume_claims:
      type: object
      title: Persistent Volume Claim
      description: PVCs that you will create and mount to your statefulset
      x-ui-override-disable: true
      x-ui-toggle: true
      patternProperties:
        "^[a-zA-Z0-9_-]*$":
          type: object
          title: PVC
          description: Define volume details
          properties:
            access_mode:
              title: Access Mode
              type: string
              enum:
                - ReadWriteOnce
                - ReadWriteMany
              description: Define read-write access of the pvc
            storage_size:
              type: string
              title: Storage Size
              description: The storage size of the pvc , it should be specified like `10Gi`
              minLength: 1
              pattern: "^(0\\.[1-9]|[1-9](\\.[0-9]+)?|[1-5][0-9](\\.[0-9]+)?|6[0-4])Gi$|^([1-9](\\.[0-9]+)?|[1-9][0-9]{1,3}(\\.[0-9]+)?|[1-5][0-9]{4}(\\.[0-9]+)?|6[0-3][0-9]{3}(\\.[0-9]+)?|64000)Mi$"
              x-ui-placeholder: "e.g., '800Mi' or '1.5Gi'"
              x-ui-error-message: "Value doesn't match pattern, it should be number ranging from 1Gi to 64Gi or 1Mi to 64000Mi"
            path:
              type: string
              title: Path
              description: Path to mount the PVC
              pattern: "^(/[^/]+)*(/)?$"
              x-ui-error-message: "Value doesn't match pattern, eg: / or /<path> etc"
              x-ui-placeholder: "Enter the storage size, eg. /data/temp"
          required:
            - access_mode
            - path
            - storage_size
    enable_host_anti_affinity:
      type: boolean
      title: Enable Host Anti-Affinity
      description: Distribute instances across different physical hosts within cluster
    runtime:
      type: object
      title: Runtime (Main Application Container)
      description: Customize service runtime settings like ports, healthchecks etc.
      properties:
        command:
          type: array
          title: Command
          description: Command to run in the container
          items:
            type: string
          x-ui-command: true
          x-ui-override-disable: true
        args:
          type: array
          title: Arguments
          description: Arguments to pass to the command
          items:
            type: string
          x-ui-command: true
          x-ui-override-disable: true
        health_checks:
          type: object
          title: Health Checks
          description: Ensure service remains responsive and operational. Assess its status and performance.
          x-ui-override-disable: true
          x-ui-toggle: true
          properties:
            readiness_check_type:
              type: string
              title: Readiness Check Type
              default: None
              x-ui-no-sort: true
              enum:
                - None
                - PortCheck
                - HttpCheck
                - ExecCheck
            liveness_check_type:
              type: string
              title: Liveness Check Type
              default: None
              x-ui-no-sort: true
              enum:
                - None
                - PortCheck
                - HttpCheck
                - ExecCheck
        size:
          type: object
          title: Size
          description: Configure container size to meet resource requirements
          properties:
            cpu:
              type: string
              title: CPU
              description: CPU size
              pattern: "^([1-9]|[12][0-9]|3[0-2])$|^(3[0-1][0-9]{3}|[1-2][0-9]{4}|[1-9][0-9]{0,3}|32000)m$"
              x-ui-placeholder: "Enter CPU requests for your application"
              x-ui-error-message: "Value doesn't match pattern, it should be number ranging from 1 to 32 or 1m to 32000m"
            memory:
              type: string
              title: Memory
              description: Memory size
              pattern: "^([1-9]|[1-5][0-9]|6[0-4])Gi$|^([1-9]|[1-9][0-9]{1,3}|[1-5][0-9]{4}|6[0-3][0-9]{3}|64000)Mi$"
              x-ui-placeholder: "Enter Memory requests for your application"
              x-ui-error-message: "Value doesn't match pattern, it should be number ranging from 1Gi to 64Gi or 1Mi to 64000Mi"
            cpu_limit:
              type: string
              title: CPU Limit
              description: CPU limit size
              pattern: "^([1-9]|[12][0-9]|3[0-2])$|^(3[0-1][0-9]{3}|[1-2][0-9]{4}|[1-9][0-9]{0,3}|32000)m$"
              x-ui-placeholder: "Enter CPU limits for your application"
              x-ui-error-message: "Value doesn't match pattern, it should be number ranging from 1 to 32 or 1m to 32000m"
            memory_limit:
              type: string
              title: Memory Limit
              description: Memory limit size
              pattern: "^([1-9]|[1-5][0-9]|6[0-4])Gi$|^([1-9]|[1-9][0-9]{1,3}|[1-5][0-9]{4}|6[0-3][0-9]{3}|64000)Mi$"
              x-ui-placeholder: "Enter Memory limits for your application"
              x-ui-error-message: "Value doesn't match pattern, it should be number ranging from 1Gi to 64Gi or 1Mi to 64000Mi"
          required:
            - cpu
            - memory
        ports:
          type: object
          title: Ports
          x-ui-override-disable: true
          description: Port mappings
          patternProperties:
            "^[0-9]+[m]?$":
              type: object
              title: Port Name
              description: Define port allocation to facilitate communication with service
              properties:
                port:
                  type: string
                  title: Port
                  description: Port on which application is running
                  pattern: "^(?!0$)([1-9][0-9]{0,3}|[1-5][0-9]{4}|6[0-4][0-9]{3}|65[0-4][0-9]{2}|655[0-2][0-9]|6553[0-5])$"
                  x-ui-unique: true
                  x-ui-placeholder: "Enter the port number to expose for your application container"
                  x-ui-error-message: "Value doesn't match pattern, it should be number ranging from 1-65535"
                service_port:
                  type: string
                  title: Service Port
                  description: Port from which application service can be exposed
                  pattern: "^(?!0$)([1-9][0-9]{0,3}|[1-5][0-9]{4}|6[0-4][0-9]{3}|65[0-4][0-9]{2}|655[0-2][0-9]|6553[0-5])$"
                  x-ui-unique: true
                  x-ui-placeholder: "Enter the port number to expose for your application service"
                  x-ui-error-message: "Value doesn't match pattern, it should be number ranging from 1-65535"
                protocol:
                  type: string
                  title: Protocol
                  description: TCP or UDP
                  enum:
                    - tcp
                    - udp
              required:
                - protocol
                - port
      required:
        - ports
        - size
        - health_checks
      x-ui-order:
        - ports
        - size
        - health_checks
        - command
        - args
    release:
      title: Release
      description: Manage version releases to deploy updates and maintain software integrity
      type: object
      properties:
        image:
          type: string
          title: Image
          description: The docker image of the application that you want to run
          x-ui-skip: true
          x-ui-error-message: "Value doesn't match pattern for a container image"
        image_pull_policy:
          type: string
          title: Image Pull Policy
          description: Specifies when the image should be pulled from the registry.
          default: IfNotPresent
          enum:
            - IfNotPresent
            - Always
            - Never
        build:
          type: object
          title: Build
          description: These contains the build objects required for running the containers
          properties:
            artifactory:
              type: string
              title: Artifactory
              description: Parent artifactory name
            name:
              type: string
              title: Name
              description: Name of the artifactory
            pull_policy:
              type: string
              title: Pull Policy
              description: ImagePullPolicy
              enum:
                - IfNotPresent
                - Always
                - Never
          required: 
            - artifactory
            - name
          x-ui-skip: true
        strategy:
          type: object
          title: Strategy
          description: The type of upgrade strategy to be followed by this service
          properties:
            type:
              type: string
              title: Type
              description: "Your kubernetes rollout type eg: RollingUpdate or Recreate"
              enum:
                - RollingUpdate
                - Recreate
            max_available:
              type: string
              title: Max Available
              description: If type RollingUpdate, this is the max number of pods that can be created from the default replicas
              pattern: "^((100|[1-9]?[0-9])%?)$"
              x-ui-placeholder: "Enter the max number or percentage of pods that needs to be available during rolling restart"
              x-ui-error-message: "Value doesn't match pattern, it should be number ranging from 0 to 100 or 0% to 100%"
            max_unavailable:
              type: string
              title: Max Unavailable
              description: If type RollingUpdate, this is the max number of pods that can be unavailable from the default replicas
              pattern: "^((100|[1-9]?[0-9])%?)$"
              x-ui-placeholder: "Enter the max number or percentage of pods that needs to be unavailable during rolling restart"
              x-ui-error-message: "Value doesn't match pattern, it should be number ranging from 0 to 100 or 0% to 100%"
  required:
    - persistent_volume_claims
  x-ui-order:
    - enable_host_anti_affinity
    - persistent_volume_claims
    - runtime
    - release
sample:
  $schema: "https://facets-cloud.github.io/facets-schemas/schemas/service/service.schema.json"
  flavor: statefulset
  metadata:
    labels:
      deliveryType: MANUAL
  kind: service
  disabled: true
  version: "0.1"
  spec:
    enable_host_anti_affinity: false
    type: statefulset
    persistent_volume_claims: {}
    release:
      strategy:
        type: RollingUpdate
    runtime:
      args: []
      command: []
      ports: {}
      size:
        cpu: "300m"
        memory: "1Gi"
        cpu_limit: "1000m"
        memory_limit: "5Gi"
      health_checks:
        readiness_check_type: "None"
        liveness_check_type: "None"
