intent: service
flavor: k8s_job
version: '0.1'
description: Adds service module
clouds:
- aws
- azure
- gcp
- kubernetes
artifact_inputs: 
  primary: 
    attribute_path: "spec.release.image" 
    artifact_type: "docker_image"
spec:
  title: K8s flavor of service
  type: object
  properties:
    type:
      type: string
      title: Service Type
      description: Type - Job
      x-ui-override-disable: true
      default: job
    job:
      type: object
      title: Job
      description: Manage execution of a one-off task or batch process, ensuring it completes successfully
      x-ui-override-disable: true
      x-ui-toggle: true
      properties:
        retry:
          type: string
          default: 5
          minimum: 1
          x-ui-placeholder: "Enter Min retry count for your job"
          description: Number of time you want to retry the job before calling it a failure
      required:
        - retry
    runtime:
      type: object
      title: Runtime
      description: Customize service runtime settings like ports, healthchecks etc.
      properties:
        command:
          type: array
          title: Command
          description: Command to run in the container
          items:
            type: string
          x-ui-command: true
        args:
          type: array
          title: Arguments
          description: Arguments to pass to the command
          items:
            type: string
          x-ui-command: true
        health_checks:
          type: object
          title: Health Checks
          description: Ensure service remains responsive and operational. Assess its status and performance.
          x-ui-override-disable: true
          x-ui-toggle: true
          properties:
            readiness_check_type:
              type: string
              title: Readiness Check Type
              default: None
              x-ui-no-sort: true
              enum:
                - None
                - PortCheck
                - HttpCheck
                - ExecCheck
            readiness_start_up_time:
              type: integer
              title: Readiness Start-Up Time
              default: 10
              minimum: 0
              maximum: 10000
              x-ui-placeholder: "Enter readiness start up time for the Pod"
              x-ui-error-message: "Value doesn't match pattern, accepted values are from 0-10000"
              x-ui-visible-if:
                field: spec.runtime.health_checks.readiness_check_type
                values: [ "PortCheck", "HttpCheck", "ExecCheck" ]
              description: Wait time for readiness check (in sec)
            readiness_timeout:
              type: integer
              title: Readiness Timeout
              default: 10
              minimum: 0
              maximum: 10000
              x-ui-placeholder: "Enter readiness timeout for the Pod"
              x-ui-error-message: "Value doesn't match pattern, accepted values are from 0-10000"
              x-ui-visible-if:
                field: spec.runtime.health_checks.readiness_check_type
                values: [ "PortCheck", "HttpCheck", "ExecCheck" ]
              description: Max time for readiness (in sec)
            readiness_period:
              type: integer
              title: Readiness Check Interval
              default: 10
              minimum: 0
              maximum: 10000
              x-ui-placeholder: "Enter readiness period for the Pod"
              x-ui-error-message: "Value doesn't match pattern, accepted values are from 0-10000"
              x-ui-visible-if:
                field: spec.runtime.health_checks.readiness_check_type
                values: [ "PortCheck", "HttpCheck", "ExecCheck" ]
              description: Repeated interval for health-check (in sec)
            readiness_port:
              type: string
              title: Readiness Port
              x-ui-placeholder: "Enter readiness port for the Pod"
              x-ui-error-message: "Value doesn't match pattern, accepted values are from 0-65535"
              x-ui-visible-if:
                field: spec.runtime.health_checks.readiness_check_type
                values: [ "PortCheck", "HttpCheck" ]
              description: Port for Health Checks
              x-ui-dynamic-enum: spec.runtime.ports.*.port
              x-ui-disable-tooltip: "No Ports Added"
            readiness_url:
              type: string
              title: Readiness URL
              pattern: '^(/[^/]+)*(/)?$'
              x-ui-placeholder: "Enter readiness url for the Pod"
              x-ui-error-message: "Value doesn't match pattern, eg: / , /<path>"
              x-ui-visible-if:
                field: spec.runtime.health_checks.readiness_check_type
                values: [ "HttpCheck" ]
              description: URL for readiness
            readiness_exec_command:
              type: array
              title: Readiness Exec Command
              pattern: '^([^,]+)(,\s*[^,]+)*$'
              x-ui-placeholder: "Enter readiness exec for the Pod, commands are separated by commas"
              x-ui-error-message: "Value doesn't match pattern, commands needs to be comma separated"
              x-ui-visible-if:
                field: spec.runtime.health_checks.readiness_check_type
                values: [ "ExecCheck" ]
              description: Commands for readiness check

            liveness_check_type:
              type: string
              title: Liveness Check Type
              default: None
              x-ui-no-sort: true
              enum:
                - None
                - PortCheck
                - HttpCheck
                - ExecCheck
            liveness_start_up_time:
              type: integer
              default: 10
              title: Liveness Start-Up Time
              minimum: 0
              maximum: 10000
              x-ui-placeholder: "Enter liveness start up time for the Pod"
              x-ui-error-message: "Value doesn't match pattern, accepted values are from 0-10000"
              x-ui-visible-if:
                field: spec.runtime.health_checks.liveness_check_type
                values: [ "PortCheck", "HttpCheck", "ExecCheck" ]
              description: Wait time for liveness (in sec)
            liveness_timeout:
              type: integer
              default: 10
              title: Liveness Timeout
              minimum: 0
              maximum: 10000
              x-ui-placeholder: "Enter liveness timeout for the Pod"
              x-ui-error-message: "Value doesn't match pattern, accepted values are from 0-10000"
              x-ui-visible-if:
                field: "spec.runtime.health_checks.liveness_check_type"
                values: [ "PortCheck", "HttpCheck", "ExecCheck" ]
              description: Max time for liveness (in sec)
            liveness_period:
              type: integer
              title: Liveness Check Interval
              default: 10
              minimum: 0
              maximum: 10000
              x-ui-placeholder: "Enter liveness period for the Pod"
              x-ui-error-message: "Value doesn't match pattern, accepted values are from 0-10000"
              x-ui-visible-if:
                field: "spec.runtime.health_checks.liveness_check_type"
                values: [ "PortCheck", "HttpCheck", "ExecCheck" ]
              description: Interval for Liveness (in sec)
            liveness_port:
              type: string
              title: Liveness Port
              x-ui-placeholder: "Enter liveness port for the Pod"
              x-ui-error-message: "Value doesn't match pattern, accepted values are from 0-65535"
              x-ui-visible-if:
                field: "spec.runtime.health_checks.liveness_check_type"
                values: [ "PortCheck", "HttpCheck" ]
              description: Port for Health Checks
              x-ui-dynamic-enum: spec.runtime.ports.*.port
              x-ui-disable-tooltip: "No Ports Added"
            liveness_url:
              type: string
              title: Liveness URL
              pattern: '^(/[^/]+)*(/)?$'
              x-ui-placeholder: "Enter liveness url for the Pod"
              x-ui-error-message: "Value doesn't match pattern, eg: / , /<path>"
              x-ui-visible-if:
                field: "spec.runtime.health_checks.liveness_check_type"
                values: [ "HttpCheck" ]
              description: URL for liveness
            liveness_exec_command:
              type: array
              title: Liveness Exec Command
              pattern: '^([^,]+)(,\s*[^,]+)*$'
              x-ui-placeholder: "Enter readiness exec for the Pod, commands are separated by commas"
              x-ui-error-message: "Value doesn't match pattern, commands needs to be comma separated"
              x-ui-visible-if:
                field: "spec.runtime.health_checks.liveness_check_type"
                values: [ "ExecCheck" ]
              description: Commands for liveness
          required:
            - readiness_port
            - readiness_url
            - readiness_exec_command
            - liveness_port
            - liveness_url
            - liveness_exec_command
        autoscaling:
          type: object
          title: Autoscaling
          description: Automatically adjust resources based on demand for optimal performance
          x-ui-toggle: true
          properties:
            min:
              type: integer
              title: Min
              default: 1
              minimum: 1
              maximum: 200
              description: Min replicas
              x-ui-placeholder: "Enter Min replicas for you application"
              x-ui-error-message: "Value doesn't match pattern, number should be ranging from 1-200"
            max:
              type: integer
              title: Max
              default: 1
              minimum: 1
              maximum: 200
              description: Max replicas
              x-ui-placeholder: "Enter Max replicas for you application"
              x-ui-validation: "spec.runtime.autoscaling.max > spec.runtime.autoscaling.min"
              x-ui-error-message: "Value doesn't match pattern, number should be ranging from 1-200 and Max should be more than Min"
            scaling_on:
              type: string
              title: Scale based on
              default: CPU
              enum:
                - CPU
                - RAM
            cpu_threshold:
              type: string
              title: CPU Threshold
              description: Max CPU threshold
              pattern: '^(1?[0-9]?[0-9]|100)$'
              x-ui-placeholder: "Enter cpu threshold for you application to scale"
              x-ui-error-message: "Value doesn't match pattern, number should be ranging from 1-100"
              x-ui-visible-if:
                field: "spec.runtime.autoscaling.scaling_on"
                values: [ "CPU" ]
            ram_threshold:
              type: string
              title: RAM Threshold
              description: Max RAM threshold
              pattern: '^(1?[0-9]?[0-9]|100)$'
              x-ui-placeholder: "Enter memory threshold for you application to scale"
              x-ui-error-message: "Value doesn't match pattern, number should be ranging from 1-100"
              x-ui-visible-if:
                field: "spec.runtime.autoscaling.scaling_on"
                values: [ "RAM" ]
        size:
          type: object
          title: Size
          description: Configure container size to meet resource requirements
          properties:
            cpu:
              type: string
              title: CPU
              description: CPU size
              pattern: '^([1-9]|[12][0-9]|3[0-2])$|^(3[0-1][0-9]{3}|[1-2][0-9]{4}|[1-9][0-9]{0,3}|32000)m$'
              x-ui-placeholder: "Enter CPU requests for your application"
              x-ui-error-message: "Value doesn't match pattern, it should be number ranging from 1 to 32 or 1m to 32000m"
            memory:
              type: string
              title: Memory
              description: Memory size
              pattern: '^([1-9]|[1-5][0-9]|6[0-4])Gi$|^([1-9]|[1-9][0-9]{1,3}|[1-5][0-9]{4}|6[0-3][0-9]{3}|64000)Mi$'
              x-ui-placeholder: "Enter Memory requests for your application"
              x-ui-error-message: "Value doesn't match pattern, it should be number ranging from 1Gi to 64Gi or 1Mi to 64000Mi"
            cpu_limit:
              type: string
              title: CPU Limit
              description: CPU limit size
              pattern: '^([1-9]|[12][0-9]|3[0-2])$|^(3[0-1][0-9]{3}|[1-2][0-9]{4}|[1-9][0-9]{0,3}|32000)m$'
              x-ui-placeholder: "Enter CPU limits for your application"
              x-ui-error-message: "Value doesn't match pattern, it should be number ranging from 1 to 32 or 1m to 32000m"
            memory_limit:
              type: string
              title: Memory Limit
              description: Memory limit size
              pattern: '^([1-9]|[1-5][0-9]|6[0-4])Gi$|^([1-9]|[1-9][0-9]{1,3}|[1-5][0-9]{4}|6[0-3][0-9]{3}|64000)Mi$'
              x-ui-placeholder: "Enter Memory limits for your application"
              x-ui-error-message: "Value doesn't match pattern, it should be number ranging from 1Gi to 64Gi or 1Mi to 64000Mi"
          required:
            - cpu
            - memory
        ports:
          type: object
          title: Ports
          x-ui-override-disable: true
          description: Port mappings
          patternProperties:
            type: object
            title: Port Name
            description: Define port allocation to facilitate communication with service
            keyPattern: '^[0-9]+[m]?$'
            properties:
              port:
                type: string
                title: Port
                description: Pod port
                pattern: '^(0|[1-9][0-9]{0,3}|[1-5][0-9]{4}|6[0-4][0-9]{3}|65[0-4][0-9]{2}|655[0-2][0-9]|6553[0-5])$'
                x-ui-placeholder: "Enter the port number to expose for your application container"
                x-ui-error-message: "Value doesn't match pattern, it should be number ranging from 0-65535"
              service_port:
                type: string
                title: Service Port
                description: Service port
                pattern: '^(0|[1-9][0-9]{0,3}|[1-5][0-9]{4}|6[0-4][0-9]{3}|65[0-4][0-9]{2}|655[0-2][0-9]|6553[0-5])$'
                x-ui-placeholder: "Enter the port number to expose for your application service"
                x-ui-error-message: "Value doesn't match pattern, it should be number ranging from 0-65535"
              protocol:
                type: string
                title: Protocol
                description: TCP or UDP
                enum:
                  - tcp
                  - udp
            required:
              - protocol
              - port
        metrics:
          type: object
          title: Metrics
          x-ui-override-disable: true
          x-ui-toggle: true
          description: Metrics port mappings
          patternProperties:
            type: object
            title: Metrics Name
            description: Track and analyze performance metrics to monitor service health and efficiency
            keyPattern: '^[a-zA-Z0-9_.-]*$'
            properties:
              path:
                type: string
                title: Path
                description: Metrics path
                pattern: '^(/[^/]+)*(/)?$'
              port_name:
                type: string
                title: Port Name
                description: Port name for metrics
                x-ui-dynamic-enum: spec.runtime.ports.*
                x-ui-disable-tooltip: "No Ports Available"
            required:
              - path
              - port_name
          x-ui-skip: true
        volumes:
          type: object
          title: Volumes
          x-ui-override-disable: true
          x-ui-toggle: true
          description: Manage data storage volumes to ensure access and persistence
          properties:
            config_maps:
              type: object
              title: Config Maps
              description: Config map mounts
              patternProperties:
                type: object
                title: Config Map Name
                keyPattern: "^[a-zA-Z0-9_.-]*$"
                properties:
                  name:
                    type: string
                    title: Name
                    description: Config map name
                  mount_path:
                    type: string
                    title: Mount Path
                    description: Mount path for config maps
                  sub_path:
                    type: string
                    title: Sub Path
                    description: Path within the ConfigMap to mount a specific key or file
                required:
                  - name
                  - mount_path
            secrets:
              type: object
              title: Secrets
              description: Secret mounts
              patternProperties:
                type: object
                title: Secret name
                keyPattern: "^[a-zA-Z0-9_.-]*$"
                properties:
                  name:
                    type: string
                    title: Name
                    description: Secret name
                  mount_path:
                    type: string
                    title: Mount Path
                    description: Mount path for secrets
                  sub_path:
                    type: string
                    title: Sub Path
                    description: Path within the Secret to mount a specific key or file
                required:
                  - name
                  - mount_path
            pvc:
              type: object
              title: PVC
              description: PVC mounts
              patternProperties:
                type: object
                title: PVC Name
                keyPattern: "^[a-zA-Z0-9_.-]*$"
                properties:
                  claim_name:
                    type: string
                    title: Claim Name
                    description: PVC name
                  mount_path:
                    type: string
                    title: Mount Path
                    description: Mount path for PVC
                  sub_path:
                    type: string
                    title: Sub Path
                    description: Path within the PVC to mount a specific subdirectory
                required:
                  - claim_name
                  - mount_path
            host_path:
              type: object
              title: Host Path
              description: Host path mounts
              patternProperties:
                type: object
                title: Host Path Name
                keyPattern: "^[a-zA-Z0-9_.-]*$"
                properties:
                  mount_path:
                    type: string
                    title: Mount Path
                    description: Mount path for host path
                  sub_path:
                    type: string
                    title: Sub Path
                    description: Path within the host filesystem to mount a specific directory or file
                required:
                  - name
                  - mount_path
      required:
        - ports
        - size
      x-ui-order:
        - ports
        - size
  required:
    - job
    - runtime
  x-ui-order:
    - job
    - runtime
sample:
  $schema: >-
    https://facets-cloud.github.io/facets-schemas/schemas/service/service.schema.json
  metadata:
    name: job-service
  disabled: true
  flavor: k8s_job
  kind: service
  version: '0.1'
  spec:
    type: job
    job: {}
    runtime:
      args: [ ]
      command: [ ]
      autoscaling:
        scaling_on: CPU
        min: '1'
        max: '1'
        cpu_threshold: '50'
      ports: { }
      size:
        cpu: 100m
        memory: 500Mi
        cpu_limit: 500m
        memory_limit: 1Gi
      volumes: { }
