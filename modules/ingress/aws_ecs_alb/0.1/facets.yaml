intent: ingress
flavor: aws_ecs_alb
version: "0.1"
description: Configures AWS ECS with Application Load Balancer
clouds:
  - aws
inputs:
  network_details:
    type: "@outputs/aws_vpc"
    title: Network Details
    description: Network configuration details
    default:
      resource_type: network
      resource_name: default
spec:
  title: AWS ECS ALB Configuration
  type: object
  properties:
    public:
      type: boolean
      title: Public Access
      description: Whether the service should be publicly accessible
      default: false
    rules:
      type: object
      title: Forwarding Rules
      description: Map of rules for forwarding traffic
      patternProperties:
        "^[a-zA-Z0-9_\\-]+$":
          properties:
            ecs_service_arn:
              type: string
              title: ECS Service ARN
              description: ARN of the ECS service
              x-ui-api-source:
                endpoint: "/cc-ui/v1/dropdown/stack/{{stackName}}/resources-info"
                method: GET
                params:
                  includeContent: false
                labelKey: resourceName
                valueKey: resourceName
                valueTemplate: "${ecs_service.{{value}}.out.attributes.ecs_service_arn}"
                filterConditions:
                  - field: resourceType
                    value: ecs_service
              x-ui-typeable: true
            port:
              type: integer
              title: Port
              description: Port to forward traffic to
            priority:
              type: integer
              title: Priority
              description: Priority of the rule
          type: object
          required:
            - ecs_service_arn
            - port
            - priority
  required:
    - public
    - rules
sample:
  $schema: >-
    https://facets-cloud.github.io/facets-schemas/schemas/service/aws_ecs_alb.schema.json
  flavor: aws_ecs_alb
  metadata:
    labels:
      deliveryType: MANUAL
  kind: ingress
  disabled: true
  version: "0.1"
  spec:
    public: true
    rules:
      rule1:
        ecs_service_arn: "${ecs_service.myservice.out.attributes.ecs_service_arn}"
        port: 80
        priority: 1