intent: openbao
flavor: default
version: '1.0'
clouds:
- azure
description: Deploys OpenBao with static seal auto-unseal for Kubernetes
metadata:
  title: Metadata of service
  type: object
  properties:
    namespace:
      type: string
      title: Kubernetes Namespace
      description: Kubernetes namespace to deploy OpenBao (will be created if it doesn't
        exist)
      default: default
      pattern: ^[a-z0-9]([-a-z0-9]*[a-z0-9])?$
spec:
  title: Auto-Unsealing OpenBao Cluster
  description: Deploys OpenBao with static seal auto-unseal - pods auto-unseal on
    restart
  type: object
  properties:
    release_name:
      type: string
      title: Helm Release Name
      description: Helm release name for the OpenBao deployment
      default: openbao
      pattern: ^[a-z0-9]([-a-z0-9]*[a-z0-9])?$
    chart_version:
      type: string
      title: Helm Chart Version
      description: Version of the OpenBao Helm chart to deploy
      default: 0.18.4
    server_replicas:
      type: integer
      title: Server Replicas
      description: Number of OpenBao server replicas
      default: 1
      minimum: 1
      maximum: 10
    server_resources:
      type: object
      title: Server Resources
      description: CPU and memory resource requests/limits for OpenBao servers
      default:
        requests:
          cpu: 500m
          memory: 256Mi
        limits:
          cpu: 1000m
          memory: 512Mi
      properties:
        requests:
          type: object
          title: Resource Requests
          description: Minimum resources required
          default:
            cpu: 500m
            memory: 256Mi
          properties:
            cpu:
              type: string
              title: CPU Request
              default: 500m
            memory:
              type: string
              title: Memory Request
              default: 256Mi
        limits:
          type: object
          title: Resource Limits
          description: Maximum resources allowed
          default:
            cpu: 1000m
            memory: 512Mi
          properties:
            cpu:
              type: string
              title: CPU Limit
              default: 1000m
            memory:
              type: string
              title: Memory Limit
              default: 512Mi
    ui_enabled:
      type: boolean
      title: Enable UI
      description: Whether to enable OpenBao web UI
      default: true
    storage_type:
      type: string
      title: Storage Backend
      description: Storage backend for OpenBao (raft for HA, file for standalone)
      default: raft
      enum:
      - file
      - raft
    storage_size:
      type: string
      title: PVC Storage Size
      description: Size of persistent volume for each OpenBao server
      default: 10Gi
    pvc_labels:
      type: object
      title: PVC Labels
      description: Additional labels to apply to PersistentVolumeClaims
      default: {}
    unseal_secret_name:
      type: string
      title: Unseal Secret Name
      description: Name of the Kubernetes secret storing the unseal key (defaults
        to instance name + '-unseal-key' for uniqueness)
      pattern: ^[a-z0-9]([-a-z0-9]*[a-z0-9])?$
    openbao:
      type: object
      title: Advanced OpenBao Configuration
      description: Advanced configuration options for OpenBao Helm chart
      properties:
        policies:
          type: object
          title: OpenBao Policies
          description: Define custom policies, roles, and service account bindings
            for OpenBao
          default: {}
          patternProperties:
            .*:
              type: object
              properties:
                service_account_name:
                  type: string
                  title: Service Account Name
                  description: Kubernetes service account name to bind to this policy
                role_name:
                  type: string
                  title: Role Name
                  description: OpenBao Kubernetes auth role name
                policy:
                  type: string
                  title: Policy HCL
                  description: OpenBao policy in HCL format
                  x-ui-editor: true
                  x-ui-editor-language: hcl
              required:
              - service_account_name
              - role_name
              - policy
        values:
          type: object
          title: Custom Helm Values
          description: Additional Helm values to merge with constructed values
          default: {}
          x-ui-editor: true
  required:
  - namespace
  - release_name
  - storage_type
inputs:
  kubernetes_cluster:
    type: '@outputs/kubernetes'
    optional: false
    displayName: Kubernetes Cluster
    description: Kubernetes cluster to deploy OpenBao
    providers:
    - helm
    - kubernetes
outputs:
  default:
    type: '@outputs/openbao'
    title: OpenBao Cluster
    description: OpenBao cluster connection information
iac:
  validated_files:
  - main.tf
  - variables.tf
  - outputs.tf
sample:
  kind: openbao
  flavor: default
  version: '1.0'
  disabled: true
  spec:
    namespace: default
    release_name: openbao
    storage_type: raft
    openbao:
      policies:
        control-plane-rw:
          service_account_name: control-plane-service-sa
          role_name: control-plane-role
          policy: "# Full read-write access to all secrets\npath \"cp-secrets/*\"\
            \ {\n  capabilities = [\"create\", \"read\", \"update\", \"delete\", \"\
            list\"]\n}\n\npath \"cp-secrets/data/*\" {\n  capabilities = [\"create\"\
            , \"read\", \"update\", \"delete\", \"list\"]\n}\n\npath \"cp-secrets/metadata/*\"\
            \ {\n  capabilities = [\"list\", \"read\", \"delete\"]\n}\n\n# System\
            \ health check\npath \"sys/health\" {\n  capabilities = [\"read\"]\n}\n"
        facets-release-readonly:
          service_account_name: facets-release-pod
          role_name: facets-release-role
          policy: "# Read-only access to all secrets\npath \"cp-secrets/*\" {\n  capabilities\
            \ = [\"read\", \"list\"]\n}\n\npath \"cp-secrets/data/*\" {\n  capabilities\
            \ = [\"read\", \"list\"]\n}\n\npath \"cp-secrets/metadata/*\" {\n  capabilities\
            \ = [\"read\", \"list\"]\n}\n\n# System health check\npath \"sys/health\"\
            \ {\n  capabilities = [\"read\"]\n}\n"
